<!DOCTYPE html>
<html lang="en">
  <head>
    
	<!--
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	-->
	
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1"/>
	
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>FinBox</title>
	
	<link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/custom.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="bower_components/html5shiv/dist/html5shiv.min.js"></script>
      <script src="bower_components/respond/dist/respond.min.js"></script>
    <![endif]-->
  </head>
  
  <body>
	<!------------------------------------------------------------------------------------------------------------->
	<div class="container">	
	<nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/index.html">FinBox</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li>
				<div id="loggedAsContainer">
					<div id="loggedAsFullName"></div>
					<div id="loggedAsEmail"></div>
				</div>
			</li>
            <li>
				<div id="logoutLinkContainer">
					<a href="#" id="logoutLink" title="Logout">Logout</a>
				</div>
			</li>
          </ul>
        </div>
      </div>
    </nav>
	</div>
	<!--------------------------------------------------------------------------------------------------------->
	<div class="container">	
		<div id="welcomeContainer" class="welcomeElements">
			<div class="jumbotron">
				<h3 id="firstTimeUsername"></h3>
				<p class="lead"><a href="#" id="firstTimeLink">Log in into your account</a></p>
		    </div>
		</div>
	</div>
	<!--------------------------------------------------------------------------------------------------------->
	<div class="container">	
		<div id="loginContainer" class="loggedOffElements">
			<form id="loginForm" name="loginForm" class="form-signin" class="authForm" action="/auth" method="POST">
			   <h2 class="form-signin-heading">Log into your account or</h2>
			   <h3 class="form-signin-heading"><a href="#" id="registerLink" title="register link" >register</a></h3>
			   <div class="form-group">
				<label for="loginEmail">Email <sup>*</sup></label>
				<input type="email" class="form-control" id="loginEmail" required name="loginEmail" placeholder="Email">
			  </div>
			   <div class="form-group">
				<label for="loginPassword">Password <sup>*</sup></label>
				<input type="password" class="form-control" id="loginPassword" required name="loginPassword" placeholder="********">
			  </div>
			  <p class="help-block"><sup>*</sup> denotes required fields</p>
			  <button type="submit" class="btn btn-lg btn-success btn-block">Log in</button>
			</form>
		</div>
	</div>
	<!--------------------------------------------------------------------------------------------------------->
	<div class="container">	
		<div id="registerContainer" class="loggedOffElements">
			<form id="registerForm" class="form-signin" name="registerForm" class="authForm" action="/users" method="POST">
			  <h2 class="form-signin-heading">Register for a new account</h2>
			  <div class="form-group">
				<label for="registerFirstName">First name <sup>*</sup></label>
				<input type="text" class="form-control" id="registerFirstName" required name="registerFirstName" placeholder="First name">
			  </div>
			   <div class="form-group">
				<label for="registerLastName">Last name <sup>*</sup></label>
				<input type="text" class="form-control" id="registerLastName" required name="registerLastName" placeholder="Last name">
			  </div>
			   <div class="form-group">
				<label for="registerEmail">Email <sup>*</sup></label>
				<input type="email" class="form-control" id="registerEmail" required name="registerEmail" placeholder="Email">
			  </div>
			   <div class="form-group">
				<label for="registerPassword">Password <sup>*</sup></label>
				<input type="password" class="form-control" id="registerPassword" required name="registerPassword" placeholder="********">
			  </div>
			  <p class="help-block"><sup>*</sup> denotes required fields</p>
			  <button type="submit" class="btn btn-lg btn-success btn-block">Register</button>
			</form>
		</div>
	</div>
	<!--------------------------------------------------------------------------------------------------------->
	<div class="container">	
		<div id="filesContainer" class="loggedOnElements">
			<div class="table-responsive">
				<table id="filesTable" class="table table-condensed table-hover table-bordered">
					<caption>
						<span id="filesTableCaptionTitle">List of files</span>
						<span id="filesTableCaptionLink"><a href="#" id="uploadNewFileLink" title="+ Upload new File">+ Upload new File</a><span>
					</caption>
					<thead>
						<th>File name</th>
						<th>Creation Date</th>
						<th>Modified Date</th>
						<th>MIME type</th>
						<th>File Size</th>
						<th>Actions</th>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
    </div>
	<!------------------------------------------------------------------------------------------------------------->
	<div class="modal fade" id="uploadFileModal" tabindex="-1" role="dialog" aria-labelledby="uploadFileModalTitle">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="uploadFileModalTitle">UPLOAD FILE</h4>
		  </div>
		  <div class="modal-body">
			<form id="uploadFileForm" name="uploadFileForm" class="fileForm" enctype="multipart/form-data" action="/files" method="POST">
			  <div class="form-group">
				<label for="fileToUpdateName">File to update</label>
				<input type="text" class="form-control" id="fileToUpdateName" name="fileToUpdateName" placeholder="filename.ext">
			  </div>
			  <div class="form-group">
				<label for="fileToUpload">File to upload <small>(multiple)</small></label>
				<input type="file" class="form-control" id="fileToUpload" name="fileToUpload" multiple>
				<input type="hidden" class="form-control" value="" name="fileToUploadEmail" id="fileToUploadEmail">
			  </div>
			  <div class="modalBtnContainer">
				<button type="submit" class="btn btn-sm  btn-primary">UPLOAD</button>
				<button type="button" class="btn btn-sm  btn-primary" data-dismiss="modal">CANCEL</button>
			  </div>
			</form>
		  </div>
		</div>
	  </div>
	</div>
	<!------------------------------------------------------------------------------------------------------------->
	<div class="modal fade" id="updateFileModal" tabindex="-1" role="dialog" aria-labelledby="updateFileModalTitle">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="updateFileModalTitle">UPDATE FILE</h4>
		  </div>
		  <div class="modal-body">
			<form id="updateFileForm" name="updateFileForm" class="fileForm" enctype="multipart/form-data" action="/files" method="POST">
			  <div class="form-group">
				<label for="fileToUpdateId">File to update</label>
				<span class="form-control" id="fileToUpdateTitle">File name was not be rendered</span>
				<input type="hidden" class="form-control" name="fileToUpdateId" id="fileToUpdateId">
				<input type="hidden" class="form-control" name="fileToUpdateEmail" id="fileToUpdateEmail">
			  </div>
			  <div class="form-group">
				<label for="fileToUpdate">File to upload</label>
				<input type="file" class="form-control" id="fileToUpdate" name="fileToUpdate">
			  </div>
			  <div class="modalBtnContainer">
				<button type="submit" class="btn btn-sm  btn-primary">UPDATE</button>
				<button type="button" class="btn btn-sm  btn-primary" data-dismiss="modal">CANCEL</button>
			  </div>
			</form>
		  </div>
		</div>
	  </div>
	</div>
	<!------------------------------------------------------------------------------------------------------------->
	<div class="modal fade" id="deleteFileModal" tabindex="-1" role="dialog" aria-labelledby="deleteFileModalTitle">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="deleteFileModalTitle">PLEASE CONFIRM DELETION</h4>
		  </div>
		  <div class="modal-body">
			<form id="deleteFileForm" name="deleteFileForm" class="fileForm" enctype="application/x-www-form-urlencoded" action="/files" method="POST">
			  <div class="form-group">
				<label for="fileToDeleteId">File to update</label>
				<span class="form-control" id="fileToDeleteTitle">File name was not be rendered</span>
				<input type="hidden" class="form-control" name="fileToDeleteId" id="fileToDeleteId">
				<input type="hidden" class="form-control" name="fileToDeleteEmail" id="fileToDeleteEmail">
			  </div>
			  <div class="modalBtnContainer">
				<button type="submit" class="btn btn-sm  btn-primary">DELETE</button>
				<button type="button" class="btn btn-sm  btn-primary" data-dismiss="modal">CANCEL</button>
			  </div>
			</form>
		  </div>
		</div>
	  </div>
	</div>
	<!------------------------------------------------------------------------------------------------------------->
	<script src="bower_components/jquery/dist/jquery.min.js"></script>
	<script src="bower_components/jquery-form/jquery.form.js"></script>
	<script src="bower_components/file-saver/FileSaver.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="./js/localStorageEmulation.js"></script>
	<script src="./js/endpoint.js"></script>
	<script src="./js/scripts.js"></script>
	<script src="./js/authForm.js"></script>
	<script src="./js/fileForm.js"></script>
	<!------------------------------------------------------------------------------------------------------------->
    <script>
	
		(function(){
		
			// inspired from https://blog.guya.net/2015/06/12/sharing-sessionstorage-between-tabs-for-secure-multi-tab-authentication/
			// Modern Browsers supporting addEventListener
			
			if(window.addEventListener) 
			{
				window.addEventListener("storage",endpoint.remSessionStorage,false);
			} 
			// Backwards compatibility for older IE versions
			else 
			{
				window.attachEvent("onstorage",endpoint.remSessionStorage);
			}
			
			if(window.addEventListener) 
			{
				window.addEventListener("storage",endpoint.keepSessionStorage,false);
			} 
			// Backwards compatibility for older IE versions
			else 
			{
				window.attachEvent("onstorage",endpoint.keepSessionStorage);
			}

			// Ask other tabs for session storage
			if (!sessionStorage.length) 
			{
				localStorage.setItem('getSessionStorage', new Date());
				localStorage.removeItem('getSessionStorage');
			};
			
			if (typeof(Storage)!=="undefined") 
			{
				if (sessionStorage.getItem("AuthJWT"))
				{		
					var token=sessionStorage.getItem("AuthJWT");
					if ((token!==undefined) && (token!==null) && (token!="")) 
					{
						endpoint.setAjaxTokenHeader(token);
						endpoint.GetLoggedOnUserDetails('load',sessionStorage.getItem("AuthEmail"));
					}
					else
					{
						endpoint.pageLoginView();
					}
				}
				else
				{
					endpoint.pageLoginView();
				}
			}
			else
			{
				endpoint.pageLoginView();
			}
		})();
	</script>
	<!------------------------------------------------------------------------------------------------------------->
  </body>
</html>